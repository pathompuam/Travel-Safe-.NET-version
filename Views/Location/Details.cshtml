@model Travel_Safe.Models.LocationDetailsViewModel

@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>รายละเอียดสถานที่</h2>

<div class="location-details">
    <h3>@Model.Location.Name</h3>

    <div id="locationCarousel" class="carousel slide" data-ride="carousel">
        <!-- Indicators -->
        <ol class="carousel-indicators">
            @{
                var imageUrls = Model.Location.ImageUrls.Split(',');
                for (var i = 0; i < imageUrls.Length; i++)
                {
                    <li data-target="#locationCarousel" data-slide-to="@i" class="@(i == 0 ? "active" : "")"></li>
                }
            }
        </ol>

        <!-- Wrapper for slides -->
        <div class="carousel-inner">
            @{
                var isActive = true;
                foreach (var imageUrl in imageUrls)
                {
                    <div class="item @(isActive ? "active" : "")">
                        <img src="@imageUrl" alt="Image" style="max-height: 500px; width: 100%; display: block; margin: 0 auto;">
                    </div>
                    isActive = false;
                }
            }
        </div>

        <!-- Controls -->
        <a class="left carousel-control" href="#locationCarousel" data-slide="prev">
            <span class="glyphicon glyphicon-chevron-left"></span>
        </a>
        <a class="right carousel-control" href="#locationCarousel" data-slide="next">
            <span class="glyphicon glyphicon-chevron-right"></span>
        </a>
    </div>

    <div class="container" style="margin-top: 30px;">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-custom">
                    <div class="panel-heading">
                        <h3 class="panel-title">ข้อมูลสถานที่</h3>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-sm-6">
                                <p><strong>หมวดหมู่:</strong> @Model.Location.LocationType</p>
                                <p><strong>ที่อยู่:</strong> @Model.Location.Address</p>
                            </div>
                            <div class="col-sm-6">
                                <p><strong>เบอร์โทรศัพท์:</strong> @Model.Location.OpeningHours</p>
                                <p><strong>ค่าเข้าชม:</strong> @Model.Location.EntryFee</p>
                            </div>
                        </div>
                        <hr>
                        <p><strong>คำอธิบาย:</strong></p>
                        <p>@Model.Location.Description</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

@if (User.Identity.IsAuthenticated)
{
    <button id="btnAddToFavorites" class="btn btn-primary" data-location-id="@Model.Location.LocationId">
        เพิ่มสถานที่นี้ไปยังสถานที่ที่ชอบ
    </button>
    <button id="btnAddToWishlist" class="btn btn-secondary" data-location-id="@Model.Location.LocationId">
        เพิ่มสถานที่นี้ไปยังสถานที่ที่อยากไป
    </button>
}
else
{
    <p class="text-danger">
        กรุณา <a href="@Url.Action("Login", "Account")">เข้าสู่ระบบ</a> ก่อนเพื่อเพิ่มสถานที่นี้ไปยังรายการของคุณ
    </p>
}

<hr />

<h3>รีวิวล่าสุด</h3>

@if (Model.RecentReviews.Any())
{
    <ul>
        @foreach (var review in Model.RecentReviews)
        {
            <li>
                <a href="@Url.Action("ReviewDetails", "Review", new { id = review.ReviewId })">
                    <strong>@review.Title</strong>
                </a>
                <br />
                @review.Content.Substring(0, Math.Min(review.Content.Length, 100))...
                <br />
                <small>
                    คะแนน:
                    @for (int i = 0; i < 5; i++)
                    {
                        if (i < review.Rating)
                        {
                            <i class="fas fa-star" style="color: yellow;"></i> <!-- ดาวสีเหลือง -->
                        }
                        else
                        {
                            <i class="fas fa-star" style="color: grey;"></i> <!-- ดาวสีเทา -->
                        }
                    }
                </small> <br>
                <small>
                    เขียนโดย: @review.UserName เมื่อ @review.CreatedDate.ToString("dd/MM/yyyy")
                </small>
            </li>
        }
    </ul>
}
else
{
    <p>ยังไม่มีรีวิวสำหรับสถานที่นี้</p>
}



<a href="@Url.Action("AllReviews", "Location", new { id = Model.Location.LocationId })" class="btn btn-info">
    ดูรีวิวทั้งหมด
</a>

<script>
    $(document).ready(function () {
        $('#btnAddToFavorites').on('click', function () {
            var locationId = $(this).data('location-id');
            $.ajax({
                url: '@Url.Action("AddToFavorites", "Location")',
                type: 'POST',
                data: { locationId: locationId },
                success: function (response) {
                    alert(response.message);
                },
                error: function (xhr) {
                    alert('เกิดข้อผิดพลาด: ' + xhr.responseText);
                }
            });
        });

        $('#btnAddToWishlist').on('click', function () {
            var locationId = $(this).data('location-id');
            $.ajax({
                url: '@Url.Action("AddToWishlist", "Location")',
                type: 'POST',
                data: { locationId: locationId },
                success: function (response) {
                    alert(response.message);
                },
                error: function (xhr) {
                    alert('เกิดข้อผิดพลาด: ' + xhr.responseText);
                }
            });
        });
    });
</script>

<style>
    .panel-custom {
        border-color: #829D80;
    }

        .panel-custom > .panel-heading {
            background-color: #829D80;
            color: #ffffff;
            border-color: #829D80;
        }
</style>
